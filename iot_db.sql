DROP DATABASE IF EXISTS `iot_cs462`;
CREATE DATABASE IF NOT EXISTS `iot_cs462` DEFAULT CHARACTER SET UTF8MB4;
USE `iot_cs462`;

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET time_zone = "+00:00";

CREATE TABLE `water_meter_readings` (
  `household_ID` varchar(10) NOT NULL,
  `datetime` datetime NOT NULL,
  `date` date NOT NULL,
  `hour` time NOT NULL,
  `prev_reading` int NOT NULL,
  `current_reading` int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4;

CREATE TABLE `hourly_tags` (
  `tag_ID` varchar(10) NOT NULL , 
  `datetime` datetime NOT NULL,
  `household_ID` varchar(10) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4;

CREATE TABLE `tag_names` (
  `tag_ID` varchar(10) NOT NULL, 
  `tag_name` varchar(100) NOT NULL,
  `tagger_id` varchar(10) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4;

# Add PK and FK

ALTER TABLE `water_meter_readings`
  ADD PRIMARY KEY (`datetime`,`household_ID`);

ALTER TABLE `hourly_tags`
  ADD PRIMARY KEY (`tag_ID`, `datetime`, `household_ID`),
  ADD CONSTRAINT `hourlytags_fk1` FOREIGN KEY (`datetime`, `household_ID`) REFERENCES `water_meter_readings` (`datetime`, `household_ID`);
  
ALTER TABLE `tag_names`
  ADD PRIMARY KEY (`tag_ID`, `tag_name`),
  ADD CONSTRAINT `tagnames_fk1` FOREIGN KEY (`tag_ID`) REFERENCES `hourly_tags` (`tag_ID`);


INSERT INTO water_meter_readings VALUES 
('123456', '2022-03-04 09:00:00','2022-03-04', '08:00:00', 6606748, 6606799),
('123456', '2022-03-04 09:05:00','2022-03-04', '09:00:00', 6606799, 6606825),
('123456', '2022-03-04 09:10:00','2022-03-04', '09:00:00', 6606825, 6606900),
('123456', '2022-03-04 09:15:00','2022-03-04', '09:00:00', 6606900, 6606900),
('123456', '2022-03-04 09:20:00','2022-03-04', '09:00:00', 6606900, 6606900),
('123456', '2022-03-04 09:25:00','2022-03-04', '09:00:00', 6606900, 6606900),
('123456', '2022-03-04 09:30:00','2022-03-04', '09:00:00', 6606900, 6606900),
('123456', '2022-03-04 09:35:00','2022-03-04', '09:00:00', 6606900, 6606900),
('123456', '2022-03-04 09:40:00','2022-03-04', '09:00:00', 6606900, 6606900),
('123456', '2022-03-04 09:45:00','2022-03-04', '09:00:00', 6606900, 6606912),
('123456', '2022-03-04 09:50:00','2022-03-04', '09:00:00', 6606912, 6606912),
('123456', '2022-03-04 09:55:00','2022-03-04', '09:00:00', 6606912, 6606912),
('123456', '2022-03-04 10:00:00','2022-03-04', '09:00:00', 6606912, 6606927),
('123456', '2022-03-04 10:05:00','2022-03-04', '10:00:00', 6606927, 6606958),
('123456', '2022-03-04 10:10:00','2022-03-04', '10:00:00', 6606958, 6606963),
('123456', '2022-03-04 10:15:00','2022-03-04', '10:00:00', 6606963, 6606963),
('123456', '2022-03-04 10:20:00','2022-03-04', '10:00:00', 6606963, 6606963),
('123456', '2022-03-04 10:25:00','2022-03-04', '10:00:00', 6606963, 6606978),
('123456', '2022-03-04 10:30:00','2022-03-04', '10:00:00', 6606978, 6606999),
('123456', '2022-03-04 10:35:00','2022-03-04', '10:00:00', 6606999, 6607012),
('123456', '2022-03-04 10:40:00','2022-03-04', '10:00:00', 6607012, 6607018),
('123456', '2022-03-04 10:45:00','2022-03-04', '10:00:00', 6607018, 6607018),
('123456', '2022-03-04 10:50:00','2022-03-04', '10:00:00', 6607018, 6607018),
('123456', '2022-03-04 10:55:00','2022-03-04', '10:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:00:00','2022-03-04', '10:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:05:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:10:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:15:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:20:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:25:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:30:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:35:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:40:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:45:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:50:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 11:55:00','2022-03-04', '11:00:00', 6607018, 6607018),
('123456', '2022-03-04 12:00:00','2022-03-04', '11:00:00', 6607018, 6607018);


INSERT INTO hourly_tags VALUES 
('100', '2022-03-04 09:00:00','123456'),
('101', '2022-03-04 09:05:00','123456'),
('101', '2022-03-04 09:10:00','123456'),
('101', '2022-03-04 09:15:00','123456'),
('101', '2022-03-04 09:20:00','123456'),
('101', '2022-03-04 09:25:00','123456'),
('101', '2022-03-04 09:30:00','123456'),
('101', '2022-03-04 09:35:00','123456'),
('101', '2022-03-04 09:40:00','123456'),
('101', '2022-03-04 09:45:00','123456'),
('101', '2022-03-04 09:50:00','123456'),
('101', '2022-03-04 09:55:00','123456'),
('101', '2022-03-04 10:00:00','123456'),
('102', '2022-03-04 10:05:00','123456'),
('102', '2022-03-04 10:10:00','123456'),
('102', '2022-03-04 10:15:00','123456'),
('102', '2022-03-04 10:20:00','123456'),
('102', '2022-03-04 10:25:00','123456'),
('102', '2022-03-04 10:30:00','123456'),
('102', '2022-03-04 10:35:00','123456'),
('102', '2022-03-04 10:40:00','123456'),
('102', '2022-03-04 10:45:00','123456'),
('102', '2022-03-04 10:50:00','123456'),
('102', '2022-03-04 10:55:00','123456'),
('102', '2022-03-04 11:00:00','123456'),
('103', '2022-03-04 11:05:00','123456'),
('103', '2022-03-04 11:10:00','123456'),
('103', '2022-03-04 11:15:00','123456'),
('103', '2022-03-04 11:20:00','123456'),
('103', '2022-03-04 11:25:00','123456'),
('103', '2022-03-04 11:30:00','123456'),
('103', '2022-03-04 11:35:00','123456'),
('103', '2022-03-04 11:40:00','123456'),
('103', '2022-03-04 11:45:00','123456'),
('103', '2022-03-04 11:50:00','123456'),
('103', '2022-03-04 11:55:00','123456'),
('103', '2022-03-04 12:00:00','123456');


INSERT INTO `tag_names` VALUES 
('100', 'Showering', 'PiusLee'),
('100', 'Washing Dishes', 'JakeLee'),
('101', 'Water Plants', 'PatrickLee'),
('102', 'Clean Fish Tank', 'PiusLee');
